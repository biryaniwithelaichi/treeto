"use strict";var R=Object.defineProperty;var _=(t,e,n)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var h=(t,e,n)=>_(t,typeof e!="symbol"?e+"":e,n);const u=require("path"),F=require("./index-B-kSrMS1.js"),v=require("os"),A=require("node:fs/promises");class g extends Error{constructor(n,r=!0){var c;let i,o=!0;typeof r=="boolean"?(i=void 0,o=r):r!=null&&typeof r=="object"&&(i=r.logger,o=r.tryNextLink??!0);super(n);h(this,"name","ProviderError");h(this,"tryNextLink");this.tryNextLink=o,Object.setPrototypeOf(this,g.prototype),(c=i==null?void 0:i.debug)==null||c.call(i,`@smithy/property-provider ${o?"->":"(!)"} ${n}`)}static from(n,r=!0){return Object.assign(new this(n.message,r),n)}}class p extends g{constructor(n,r=!0){super(n,r);h(this,"name","CredentialsProviderError");Object.setPrototypeOf(this,p.prototype)}}const x=(...t)=>async()=>{if(t.length===0)throw new g("No providers in chain");let e;for(const n of t)try{return await n()}catch(r){if(e=r,r!=null&&r.tryNextLink)continue;throw r}throw e},L=t=>()=>Promise.resolve(t),I=(t,e,n)=>{let r,i,o,c=!1;const s=async()=>{i||(i=t());try{r=await i,o=!0,c=!1}finally{i=void 0}return r};return async f=>((!o||f!=null&&f.forceRefresh)&&(r=await s()),r)};function P(t){try{const e=new Set(Array.from(t.match(/([A-Z_]){3,}/g)??[]));return e.delete("CONFIG"),e.delete("CONFIG_PREFIX_SEPARATOR"),e.delete("ENV"),[...e].join(", ")}catch{return t}}const b=(t,e)=>async()=>{try{const n=t(process.env,e);if(n===void 0)throw new Error;return n}catch(n){throw new p(n.message||`Not found in ENV: ${P(t.toString())}`,{logger:e==null?void 0:e.logger})}},m={},j=()=>process&&process.geteuid?`${process.geteuid()}`:"DEFAULT",y=()=>{const{HOME:t,USERPROFILE:e,HOMEPATH:n,HOMEDRIVE:r=`C:${u.sep}`}=process.env;if(t)return t;if(e)return e;if(n)return`${r}${n}`;const i=j();return m[i]||(m[i]=v.homedir()),m[i]},$="AWS_PROFILE",D="default",T=t=>t.profile||process.env[$]||D,d=".",H=t=>Object.entries(t).filter(([e])=>{const n=e.indexOf(d);return n===-1?!1:Object.values(F.IniSectionType).includes(e.substring(0,n))}).reduce((e,[n,r])=>{const i=n.indexOf(d),o=n.substring(0,i)===F.IniSectionType.PROFILE?n.substring(i+1):n;return e[o]=r,e},{...t.default&&{default:t.default}}),U="AWS_CONFIG_FILE",q=()=>process.env[U]||u.join(y(),".aws","config"),G="AWS_SHARED_CREDENTIALS_FILE",W=()=>process.env[G]||u.join(y(),".aws","credentials"),k=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,K=["__proto__","profile __proto__"],O=t=>{const e={};let n,r;for(const i of t.split(/\r?\n/)){const o=i.split(/(^|\s)[;#]/)[0].trim();if(o[0]==="["&&o[o.length-1]==="]"){n=void 0,r=void 0;const s=o.substring(1,o.length-1),f=k.exec(s);if(f){const[,a,,l]=f;Object.values(F.IniSectionType).includes(a)&&(n=[a,l].join(d))}else n=s;if(K.includes(s))throw new Error(`Found invalid profile name "${s}"`)}else if(n){const s=o.indexOf("=");if(![0,-1].includes(s)){const[f,a]=[o.substring(0,s).trim(),o.substring(s+1).trim()];if(a==="")r=f;else{r&&i.trimStart()===i&&(r=void 0),e[n]=e[n]||{};const l=r?[r,f].join(d):f;e[n][l]=a}}}}return e},E={},C={},w=(t,e)=>C[t]!==void 0?C[t]:((!E[t]||e!=null&&e.ignoreCache)&&(E[t]=A.readFile(t,"utf8")),E[t]),S=()=>({}),V=async(t={})=>{const{filepath:e=W(),configFilepath:n=q()}=t,r=y(),i="~/";let o=e;e.startsWith(i)&&(o=u.join(r,e.slice(2)));let c=n;n.startsWith(i)&&(c=u.join(r,n.slice(2)));const s=await Promise.all([w(c,{ignoreCache:t.ignoreCache}).then(O).then(H).catch(S),w(o,{ignoreCache:t.ignoreCache}).then(O).catch(S)]);return{configFile:s[0],credentialsFile:s[1]}},M=(t,{preferredFile:e="config",...n}={})=>async()=>{const r=T(n),{configFile:i,credentialsFile:o}=await V(n),c=o[r]||{},s=i[r]||{},f=e==="config"?{...c,...s}:{...s,...c};try{const l=t(f,e==="config"?i:o);if(l===void 0)throw new Error;return l}catch(a){throw new p(a.message||`Not found in config files w/ profile [${r}]: ${P(t.toString())}`,{logger:n.logger})}},X=t=>typeof t=="function",z=t=>X(t)?async()=>await t():L(t),B=({environmentVariableSelector:t,configFileSelector:e,default:n},r={})=>{const{signingName:i,logger:o}=r;return I(x(b(t,{signingName:i,logger:o}),M(e,r),z(n)))};function Q(t){const e={};if(t=t.replace(/^\?/,""),t)for(const n of t.split("&")){let[r,i=null]=n.split("=");r=decodeURIComponent(r),i&&(i=decodeURIComponent(i)),r in e?Array.isArray(e[r])?e[r].push(i):e[r]=[e[r],i]:e[r]=i}return e}const N=t=>{if(typeof t=="string")return N(new URL(t));const{hostname:e,pathname:n,port:r,protocol:i,search:o}=t;let c;return o&&(c=Q(o)),{hostname:e,port:r?parseInt(r):void 0,protocol:i,path:n,query:c}};exports.CONFIG_PREFIX_SEPARATOR=d;exports.ProviderError=g;exports.loadConfig=B;exports.memoize=I;exports.parseUrl=N;
//# sourceMappingURL=index-AQefyu2b.js.map
