"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("fs"),T=require("./externalDataInterceptor-DLwOh7-Q.js"),g=require("./index-B-kSrMS1.js"),i=e=>async o=>{var a;(a=e.logger)==null||a.debug("@aws-sdk/credential-provider-web-identity - fromWebToken");const{roleArn:n,roleSessionName:c,webIdentityToken:s,providerId:l,policyArns:r,policy:t,durationSeconds:S}=e;let{roleAssumerWithWebIdentity:d}=e;if(!d){const{getDefaultRoleAssumerWithWebIdentity:_}=await Promise.resolve().then(()=>require("./index-dYkpNSAz.js"));d=_({...e.clientConfig,credentialProviderLogger:e.logger,parentClientConfig:{...o==null?void 0:o.callerClientConfig,...e.parentClientConfig}},e.clientPlugins)}return d({RoleArn:n,RoleSessionName:c??`aws-sdk-js-session-${Date.now()}`,WebIdentityToken:s,ProviderId:l,PolicyArns:r,Policy:t,DurationSeconds:S})},E="AWS_WEB_IDENTITY_TOKEN_FILE",N="AWS_ROLE_ARN",b="AWS_ROLE_SESSION_NAME",f=(e={})=>async()=>{var l,r,t;(l=e.logger)==null||l.debug("@aws-sdk/credential-provider-web-identity - fromTokenFile");const o=(e==null?void 0:e.webIdentityTokenFile)??process.env[E],n=(e==null?void 0:e.roleArn)??process.env[N],c=(e==null?void 0:e.roleSessionName)??process.env[b];if(!o||!n)throw new g.CredentialsProviderError("Web identity configuration not specified",{logger:e.logger});const s=await i({...e,webIdentityToken:((t=(r=T.externalDataInterceptor)==null?void 0:r.getTokenRecord)==null?void 0:t.call(r)[o])??u.readFileSync(o,{encoding:"ascii"}),roleArn:n,roleSessionName:c})();return o===process.env[E]&&g.setCredentialFeature(s,"CREDENTIALS_ENV_VARS_STS_WEB_ID_TOKEN","h"),s};exports.fromTokenFile=f;exports.fromWebToken=i;
//# sourceMappingURL=index-BAUYHH9R.js.map
