"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("./index-B-kSrMS1.js"),I=require("./parseKnownFiles--W3Yg_Lv.js"),h=(e,n,r)=>{const t={EcsContainer:async i=>{const{fromHttp:s}=await Promise.resolve().then(()=>require("./index-BgkBzDsV.js")),{fromContainerMetadata:a}=await Promise.resolve().then(()=>require("./index-CtynqzH8.js"));return r==null||r.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>o.chain(s(i??{}),a(i))().then(l)},Ec2InstanceMetadata:async i=>{r==null||r.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");const{fromInstanceMetadata:s}=await Promise.resolve().then(()=>require("./index-CtynqzH8.js"));return async()=>s(i)().then(l)},Environment:async i=>{r==null||r.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");const{fromEnv:s}=await Promise.resolve().then(()=>require("./index-DJCCUlSf.js"));return async()=>s(i)().then(l)}};if(e in t)return t[e];throw new o.CredentialsProviderError(`Unsupported credential source in profile ${n}. Got ${e}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:r})},l=e=>o.setCredentialFeature(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),R=(e,{profile:n="default",logger:r}={})=>!!e&&typeof e=="object"&&typeof e.role_arn=="string"&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(b(e,{profile:n,logger:r})||O(e,{profile:n,logger:r})),b=(e,{profile:n,logger:r})=>{var i;const t=typeof e.source_profile=="string"&&typeof e.credential_source>"u";return t&&((i=r==null?void 0:r.debug)==null||i.call(r,`    ${n} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`)),t},O=(e,{profile:n,logger:r})=>{var i;const t=typeof e.credential_source=="string"&&typeof e.source_profile>"u";return t&&((i=r==null?void 0:r.debug)==null||i.call(r,`    ${n} isCredentialSourceProfile credential_source=${e.credential_source}`)),t},A=async(e,n,r,t={},i)=>{var _,f,y;(_=r.logger)==null||_.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");const s=n[e],{source_profile:a,region:v}=s;if(!r.roleAssumer){const{getDefaultRoleAssumer:c}=await Promise.resolve().then(()=>require("./index-dYkpNSAz.js"));r.roleAssumer=c({...r.clientConfig,credentialProviderLogger:r.logger,parentClientConfig:{...r==null?void 0:r.parentClientConfig,region:v??((f=r==null?void 0:r.parentClientConfig)==null?void 0:f.region)}},r.clientPlugins)}if(a&&a in t)throw new o.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${o.getProfileName(r)}. Profiles visited: `+Object.keys(t).join(", "),{logger:r.logger});(y=r.logger)==null||y.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${a?`source_profile=[${a}]`:`profile=[${e}]`}`);const u=a?i(a,n,r,{...t,[a]:!0},C(n[a]??{})):(await h(s.credential_source,e,r.logger)(r))();if(C(s))return u.then(c=>o.setCredentialFeature(c,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{const c={RoleArn:s.role_arn,RoleSessionName:s.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:s.external_id,DurationSeconds:parseInt(s.duration_seconds||"3600",10)},{mfa_serial:d}=s;if(d){if(!r.mfaCodeProvider)throw new o.CredentialsProviderError(`Profile ${e} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:r.logger,tryNextLink:!1});c.SerialNumber=d,c.TokenCode=await r.mfaCodeProvider(d)}const m=await u;return r.roleAssumer(m,c).then(S=>o.setCredentialFeature(S,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},C=e=>!e.role_arn&&!!e.credential_source,k=e=>!!e&&typeof e=="object"&&typeof e.credential_process=="string",F=async(e,n)=>Promise.resolve().then(()=>require("./index-McTmmdyt.js")).then(({fromProcess:r})=>r({...e,profile:n})().then(t=>o.setCredentialFeature(t,"CREDENTIALS_PROFILE_PROCESS","v"))),L=async(e,n,r={})=>{const{fromSSO:t}=await Promise.resolve().then(()=>require("./index-CyfE5lqx.js"));return t({profile:e,logger:r.logger,parentClientConfig:r.parentClientConfig,clientConfig:r.clientConfig})().then(i=>n.sso_session?o.setCredentialFeature(i,"CREDENTIALS_PROFILE_SSO","r"):o.setCredentialFeature(i,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))},D=e=>e&&(typeof e.sso_start_url=="string"||typeof e.sso_account_id=="string"||typeof e.sso_session=="string"||typeof e.sso_region=="string"||typeof e.sso_role_name=="string"),E=e=>!!e&&typeof e=="object"&&typeof e.aws_access_key_id=="string"&&typeof e.aws_secret_access_key=="string"&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,P=async(e,n)=>{var t;(t=n==null?void 0:n.logger)==null||t.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");const r={accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}};return o.setCredentialFeature(r,"CREDENTIALS_PROFILE","n")},T=e=>!!e&&typeof e=="object"&&typeof e.web_identity_token_file=="string"&&typeof e.role_arn=="string"&&["undefined","string"].indexOf(typeof e.role_session_name)>-1,p=async(e,n)=>Promise.resolve().then(()=>require("./index-BAUYHH9R.js")).then(({fromTokenFile:r})=>r({webIdentityTokenFile:e.web_identity_token_file,roleArn:e.role_arn,roleSessionName:e.role_session_name,roleAssumerWithWebIdentity:n.roleAssumerWithWebIdentity,logger:n.logger,parentClientConfig:n.parentClientConfig})().then(t=>o.setCredentialFeature(t,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))),w=async(e,n,r,t={},i=!1)=>{const s=n[e];if(Object.keys(t).length>0&&E(s))return P(s,r);if(i||R(s,{profile:e,logger:r.logger}))return A(e,n,r,t,w);if(E(s))return P(s,r);if(T(s))return p(s,r);if(k(s))return F(r,e);if(D(s))return await L(e,s,r);throw new o.CredentialsProviderError(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:r.logger})},$=(e={})=>async({callerClientConfig:n}={})=>{var i;const r={...e,parentClientConfig:{...n,...e.parentClientConfig}};(i=r.logger)==null||i.debug("@aws-sdk/credential-provider-ini - fromIni");const t=await I.parseKnownFiles(r);return w(o.getProfileName({profile:e.profile??(n==null?void 0:n.profile)}),t,r)};exports.fromIni=$;
//# sourceMappingURL=index-CgK7Wr3J.js.map
