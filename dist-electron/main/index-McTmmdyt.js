"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("child_process"),w=require("util"),c=require("./index-B-kSrMS1.js"),P=require("./externalDataInterceptor-DLwOh7-Q.js"),p=require("./parseKnownFiles--W3Yg_Lv.js"),x=(r,e,s)=>{var t;if(e.Version!==1)throw Error(`Profile ${r} credential_process did not return Version 1.`);if(e.AccessKeyId===void 0||e.SecretAccessKey===void 0)throw Error(`Profile ${r} credential_process returned invalid credentials.`);if(e.Expiration){const i=new Date;if(new Date(e.Expiration)<i)throw Error(`Profile ${r} credential_process returned expired credentials.`)}let n=e.AccountId;!n&&((t=s==null?void 0:s[r])!=null&&t.aws_account_id)&&(n=s[r].aws_account_id);const o={accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,...e.SessionToken&&{sessionToken:e.SessionToken},...e.Expiration&&{expiration:new Date(e.Expiration)},...e.CredentialScope&&{credentialScope:e.CredentialScope},...n&&{accountId:n}};return c.setCredentialFeature(o,"CREDENTIALS_PROCESS","w"),o},E=async(r,e,s)=>{var o,t;const n=e[r];if(e[r]){const i=n.credential_process;if(i!==void 0){const u=w.promisify(((t=(o=P.externalDataInterceptor)==null?void 0:o.getTokenRecord)==null?void 0:t.call(o).exec)??l.exec);try{const{stdout:d}=await u(i);let a;try{a=JSON.parse(d.trim())}catch{throw Error(`Profile ${r} credential_process returned invalid JSON.`)}return x(r,a,e)}catch(d){throw new c.CredentialsProviderError(d.message,{logger:s})}}else throw new c.CredentialsProviderError(`Profile ${r} did not contain credential_process.`,{logger:s})}else throw new c.CredentialsProviderError(`Profile ${r} could not be found in shared credentials file.`,{logger:s})},S=(r={})=>async({callerClientConfig:e}={})=>{var n;(n=r.logger)==null||n.debug("@aws-sdk/credential-provider-process - fromProcess");const s=await p.parseKnownFiles(r);return E(c.getProfileName({profile:r.profile??(e==null?void 0:e.profile)}),s,r.logger)};exports.fromProcess=S;
//# sourceMappingURL=index-McTmmdyt.js.map
